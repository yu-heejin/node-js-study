## fs 모듈

- fs 모듈은 파일 시스템에 접근하는 모듈이다.
    - 즉, 파일을 생성하거나 삭제하고, 읽거나 쓸 수 있다.
    - 또한, 폴더도 만들거나 지울 수 있다.

## 동기 메서드와 비동기 메서드

- `setTimeout`, `process.nextTick` 외에도 **노드는 대부분의 메서드를 비동기 방식으로 처리**한다.
- 그러나 몇몇 메서드는 동기 방식으로도 사용할 수 있는데, 특히 `fs` 모듈이 그러한 메서드를 많이 갖고 있다.

### 동기와 비동기, 블로킹과 논블로킹

- 동기와 비동기: 백그라운드 작업 완료 확인 여부
- 블로킹과 논블로킹: 함수가 바로 `return` 되는지 여부
- 노드는 동기-블로킹 방식과 비동기-논블로킹 방식이 대부분이다.
    - 동기-논블로킹이나 비동기-블로킹은 없다.
- `동기-블로킹 방식`에서는 **백그라운드 작업 완료 여부를 계속 확인**하며, 호출한 함수가 바로 return되지 않고 **백그라운드 작업이 끝나야 return 한다.**
- `비동기-논블로킹` 방식에서는 호출한 함수가 바로 return되어 다음 작업으로 넘어가고, **백그라운드 작업 완료 여부는 신경쓰지 않고 나중에 백그라운드가 알림을 줄 때 비로소 처리한다.**

### readFileSync

- 순서대로 실행하나 요청이 수백개 이상 들어올 때 성능에 문제가 생긴다.
- `Sync` 메서드를 사용할 때는 **이전 작업이 완료되어야 다음 작업을 진행할 수 있다.**
    - 즉, **백그라운드가 작업하는 동안 메인 스레드는 아무것도 못하고 대기**하고 있어야 하고, **메인 스레드가 일을 하지 않고 노는 시간이 생기므로 비효율적이다.**
- 백그라운드는 `fs` 작업을 동시에 처리할 수도 있는데, `Sync` 메서드를 사용하면 백그라운드조차 동시에 처리할 수 없게 된다.
- 비동기 `fs` 메서드를 사용하면 백그라운드가 동시에 작업할 수도 있고, 메인 스레드는 다음 작업을 처리할 수 있다.
- 동기 메서드들은 이름 뒤에 `Sync`가 붙어 있어 구분하기 쉽다.
    - 그러나 동기 메서드를 사용해야 하는 경우는 극히 드물다.
    - 따라서 프로그램을 처음 실행할 때 초기화 용도로만 사용하는 것을 권장한다.

## 버퍼와 스트림 이해하기

- 파일을 읽거나 쓰는 방식에는 **버퍼를 이용하거나 스트림을 이용하는 방식**이 있다.
    - 영상을 로딩하고 있을 때는 버퍼링한다고 하고, 영상을 실시간으로 송출할 때는 스트리밍한다고 한다.
- **버퍼링은 영상을 재생할 수 있을 때까지 데이터를 모으는 동작**이고, **스트리밍은 방송인의 컴퓨터에서 시청자의 컴퓨터로 영상 데이터를 조금씩 전송하는 동작**이다.
    - **스트리밍하는 과정에서 버퍼링**을 할 수도 있다.
    - 전송이 너무 느리면 화면을 내보내기까지 최소한의 데이터를 모아야 하고, 영상 데이터가 재생 속도보다 빨리 전송되어도 미리 전송받은 데이터를 저장할 공간이 필요하기 때문이다.
- 노드의 버퍼와 스트림도 비슷한 개념이다.
    - `readFile` 메서드를 사용할 때 읽었던 파일이 버퍼 형식으로 출력되었다.
    - **노드는 파일을 읽을 때 메모리에 파일 크기만큼 공간을 마련**해두며, **파일 데이터를 메모리에 저장한 뒤 사용자가 조작할 수 있도록 한다.**
    - 이 때, **메모리에 저장된 데이터가 바로 버퍼**이다.
- 버퍼는 `Buffer` 클래스를 통해 직접 다룰 수 있다.
- `readFile` 방식의 버퍼가 편리하기는 하지만 문제점도 있다.
    - 만약 용량이 100MB인 파일이 있으면, 읽을 때 메모리에 100MB의 버퍼를 만들어야 한다.
    - 이 작업을 동시에 10개만 해도 1GB에 달하는 메모리가 사용된다.
    - 또한, 모든 내용을 버퍼에 다 쓴 후에야 다음 동작으로 넘어가기 때문에 파일 읽기, 압축, 파일 쓰기 등의 조작을 연달아 할 때 매번 전체 용량을 버퍼로 처리해야 다음 단계로 넘어갈 수 있다.
- 따라서, **버퍼의 크기를 작게 만들고 여러번에 걸쳐 나눠 보내는 방식이 등장**했다.
    - 예를 들어, 버퍼 1MB를 만든 후 100MB 파일을 100번에 걸쳐 나눠 보내는 것이다.