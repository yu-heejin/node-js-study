## 싱글 스레드(Single Thread)

- 하나의 스레드만을 사용하여 여러 작업요청을 처리하는 방법
- I/O 작업과 같은 경우 비동기 방식으로 처리하고, 그 동안 다른 작업을 처리하는 방식
- 한개의 콜스택으로 명령을 처리하는 Node.js는 이러한 면에서 싱글 스레드라고 할 수 있지만, **항상 싱글 스레드 방식으로 동작하지 않는다.**

## 스레드 풀(Thread Pool)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/00e5e72a-a02d-488f-8ab2-9310f6acdbda/Untitled.png)

- 멀티 스레드 모델의 경우 스레드 풀을 두고 요청을 처리할 때 스레드를 기반으로 처리한다.
- 대부분의 작업은 콜스택을 통해 처리되며, 큐를 이용해 비동기 작업을 처리하지만 **I/O, 네트워크 등의 작업은 OS에게 작업을 넘겨주는 논블로킹 방식**으로 동작한다.
    - 그러나 **OS에서 지원하지 않는 비동기 작업이나 특정 I/O 작업은 libuv에서 처리**하게 되며, 이는 내부적으로 운영되는 **스레드 풀을 이용해 논블로킹을 유지한다.**
    - 이러한 이유로 단일 콜스택 측면에서는 싱글 스레드이지만, 넓은 측면에서 본다면 무조건 싱글 스레드는 아니다!

## 이벤트 루프 멀티플랙싱(Multiplexing)

### 멀티플렉싱

- **하나의 통신 채널을 통해 다량의 데이터를 전송**하는데 사용되는 기술이다.
- 매 요청마다 새로운 프로세스나 스레드를 생성하는 것이 아니라, **요청의 갯수와 상관없이 한 개의 프로세스나 스레드를 이용하여 작업을 처리하는 방법이다.**
- 주파수 분할, 시분할 등을 예로 들 수 있다.

### Node.js에서의 멀티플렉싱

- Node.js의 모든 작업처리는 단일 콜스택에서 이루어지고, 비동기 처리는 큐를 이용하며 둘은 하나의 스레드로 이루어진 이벤트 루프를 통해 동작한다.
- 이벤트 루프는 멀티플렉싱 방식으로 동작한다.
    - 여러 개의 소켓이 동시에 연결되어 있고, 이들을 관찰하면서 들어오는 작업을 처리하는 방식이다.
- 기존의 웹서버의 경우 요청이 들어오면 이를 처리하기 위한 프로세스나 스레드를 생성하는데, 이를 대기하는 시간이 발생하고(Thread waiting), 이 과정에서 병목 현상이 발생한다.
    - 그러나 노드의 경우 다량의 작업이 요청되어도 스레드 대기가 발생하지 않고, 작업의 처리는 다른 스레드로 넘겨버리기 때문에 바로 다른 작업 요청을 받을 수 있다.
    - 다만 CPU의 영향을 많이 받는 요청의 경우 한정된 쓰레드에서 I/O 작업이 처리되며, 이를 이벤트 루프는 대기하기 때문에 이후 발생하는 다른 Request들에 병목 현상이 발생한다.

## 참고 자료

- [https://akasai.space/node-js/about_node_js_4/](https://akasai.space/node-js/about_node_js_4/)